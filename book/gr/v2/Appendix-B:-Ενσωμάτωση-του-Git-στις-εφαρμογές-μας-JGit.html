---
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: gr
  chapter:
    title: 'Appendix B: Ενσωμάτωση του Git στις εφαρμογές μας'
    number: 2
  section:
    title: JGit
    number: 3
    cs_number: A2.3
    previous: book/gr/v2/Appendix-B:-Ενσωμάτωση-του-Git-στις-εφαρμογές-μας-Libgit2
    next: book/gr/v2/Appendix-C:-Εντολές-Git-Ρύθμιση-και-διαμόρφωση
title: Git - JGit

---
<h2 id="_jgit">JGit</h2>
<div class="paragraph">
<p>
Εάν θέλουμε να χρησιμοποιήσουμε το Git μέσα σε ένα πρόγραμμα Java, υπάρχει μια πλήρως εξοπλισμένη βιβλιοθήκη Git που ονομάζεται JGit.
Το JGit είναι μια σχετικά πλήρης εφαρμογή του Git γραμμένη σε Java και χρησιμοποιείται ευρέως στην κοινότητα της Java.
Το έργο JGit βρίσκεται κάτω από ομπρέλα τοου Eclipse και το σπίτι του βρίσκεται στο <a href="http://www.eclipse.org/jgit" class="bare">http://www.eclipse.org/jgit</a>.</p>
</div>
<div class="sect3">
<h3 id="_getting_set_up">Getting Set Up</h3>
<div class="paragraph">
<p>Υπάρχουν διάφοροι τρόποι για να συνδέσουμε το έργο μας με το JGit και να αρχίσουμε να γράφουμε κώδικα σε αυτό.
Πιθανώς το πιο εύκολο είναι να χρησιμοποιήσουμε τη Maven —η ενσωμάτωση ολοκληρώνεται προσθέτοντας το ακόλουθο απόσπασμα στην ετικέτα <code>&lt;εξάρτηση&gt;</code> στο αρχείο pom.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.eclipse.jgit&lt;/groupId&gt;
    &lt;artifactId&gt;org.eclipse.jgit&lt;/artifactId&gt;
    &lt;version&gt;3.5.0.201409260305-r&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Η <code>version</code> σίγουρα έχει προχωρήσει από τότε που γραφόταν αυτό το βιβλίο· ελέγχουμε τη <a href="http://mvnrepository.com/artifact/org.eclipse.jgit/org.eclipse.jgit" class="bare">http://mvnrepository.com/artifact/org.eclipse.jgit/org.eclipse.jgit</a> για ενημερωμένες πληροφορίες για το αποθετήριο.
Μόλις ολοκληρωθεί αυτό το βήμα, η Maven θα αποκτήσει και θα χρησιμοποιήσει αυτόματα τις βιβλιοθήκες JGit που χρειαζόμαστε.</p>
</div>
<div class="paragraph">
<p>Αν προτιμάμε να διαχειρίιζόμαστε μόνοι μας τις δυαδικές εξαρτήσεις, τα προ-κατασκευασμένα δυαδικά αρχεία JGit διατίθενται από τη <a href="http://www.eclipse.org/jgit/download" class="bare">http://www.eclipse.org/jgit/download</a>.
Μπορούμε να τα χτίσουμε στο έργο μας, τρέχοντας μια εντολή όπως αυτή:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">javac -cp .:org.eclipse.jgit-3.5.0.201409260305-r.jar App.java
java -cp .:org.eclipse.jgit-3.5.0.201409260305-r.jar App</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h3 id="_διοχέτευση">Διοχέτευση</h3>
<div class="paragraph">
<p>Το JGit έχει δύο βασικά επίπεδα API: διοχέτευσης και πορσελάνης.
Η ορολογία για αυτά προέρχεται από το ίδιο το Git και το JGit χωρίζεται σε περίπου τα ίδια είδη: τα API πορσελάνης είναι ένα φιλικό πρόσθιο σύστημα για κοινές ενέργειες σε επίπεδο χρήστη (τα πράγματα που θα έκανε κανονικός χρήστης στη γραμμή εντολών Git), ενώ τα API διοχέτευσης είναι για την άμεση αλληλεπίδραση με αντικείμενα χαμηλού επιπέδου του  αποθετηρίου.</p>
</div>
<div class="paragraph">
<p>Το σημείο εκκίνησης για τις περισσότερες συνεδρίες του JGit είναι η κλάση <code>Repository</code> και το πρώτο πράγμα που θα θελήσουμε να κάνουμε είναι να δημιουργήσουμε ένα στιγμιότυπό (instance) του.
Για ένα αποθετήριο με βάση το σύστημα αρχείων (ναι, το JGit επιτρέπει και άλλα μοντέλα αποθήκευσης), αυτό επιτυγχάνεται χρησιμοποιώντας το <code>FileRepositoryBuilder</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Δημιουργία νέου αποθετηρίου
Repository newlyCreatedRepo = FileRepositoryBuilder.create(
    new File("/tmp/new_repo/.git"));
newlyCreatedRepo.create();

// Άνοιγμα υπάρχοντος αποθετηρίου
Repository existingRepo = new FileRepositoryBuilder()
    .setGitDir(new File("my_repo/.git"))
    .build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ο builder έχει ένα εύγλωττο API για να παρέχει ό,τι χρειάζεται για να βρει ένα αποθετήριο Git, ανεξάρτητα από το αν το πρόγραμμα μας γνωρίζει πού ακριβώς βρίσκεται.
Μπορεί να χρησιμοποιήσει μεταβλητές περιβάλλοντος (<code>.readEnvironment()</code>), να ξεκινήσει από μια θέση στον κατάλογο εργασίας και να αναζητήσει (<code>.setWorkTree(…).findGitDir()</code>) ή απλά να ανοίξει έναν γνωστό κατάλογο <code>.git</code> όπως παραπάνω.</p>
</div>
<div class="paragraph">
<p>Μόλις έχουμε ένα στιγμιότυπο <code>Repository</code>, μπορούμε να κάνουμε διάφορα πράγματα με αυτό.
Ακολουθεί μια γρήγορη επίδειξη:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// Πάρε μία αναφορά
Ref master = repo.getRef("master");

// Πάρε το αντικείμενο στο οποίο δείχνει η αναφορά
ObjectId masterTip = master.getObjectId();

// Rev-parse
ObjectId obj = repo.resolve("HEAD^{tree}");

// Φόρτωσε τα ανεπεξέργαστα περιεχόμενα του αντικειμένου
ObjectLoader loader = repo.open(masterTip);
loader.copyTo(System.out);

// Δημιούργησε έναν κλάδο
RefUpdate createBranch1 = repo.updateRef("refs/heads/branch1");
createBranch1.setNewObjectId(masterTip);
createBranch1.update();

// Διάγραψε έναν κλάδο
RefUpdate deleteBranch1 = repo.updateRef("refs/heads/branch1");
deleteBranch1.setForceUpdate(true);
deleteBranch1.delete();

// Διαμόρφωση
Config cfg = repo.getConfig();
String name = cfg.getString("user", null, "name");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Εδώ συμβαίνουν διάφορα, οπότε ας δούμε ένα-ένα τα διάφορα τμήματα.</p>
</div>
<div class="paragraph">
<p>Η πρώτη γραμμή παίρνει έναν δείκτη στην αναφορά <code>master</code>.
Το JGit αρπάζει αυτόματα την <em>πραγματική</em> αναφορά στον <code>master</code>, που βρίσκεται στη <code>refs/heads/master</code> και επιστρέφει ένα αντικείμενο που μας επιτρέπει να ανακτήσουμε πληροφορίες σχετικά με την αναφορά.
Μπορούμε να πάρουμε το όνομα (<code>.getName()</code>) και είτε το αντικείμενο μιας άμεσης αναφοράς (<code>.getObjectId()</code>) είτε την αναφορά στην οποία δείχνει μία συμβολική αναφορά (<code>.getTarget()</code>).
Τα αντικείμενα ref χρησιμοποιούνται επίσης για την αναπαράσταση αναφορών ετικετών και αντικειμένων, ώστε μπορούμε να ρωτήσουμε αν η ετικέτα είναι “ξεκολλημένη”, πράγμα που σημαίνει ότι δείχνει τον τελικό στόχο μιας (δυνητικά μακράς) συμβολοσειράς αντικειμένων ετικέτας.</p>
</div>
<div class="paragraph">
<p>Η δεύτερη γραμμή παίρνει το στόχο της αναφοράς <code>master</code>, ο οποίος επιστρέφεται ως παράμετρος ObjectId.
Το ObjectId αντιπροσωπεύει τον αριθμό SHA-1 ενός αντικειμένου, το οποίο μπορεί να υπάρχει ή να μην υπάρχει στη βάση δεδομένων αντικειμένων του Git.
Η τρίτη γραμμή είναι παρόμοια, αλλά δείχνει πώς το JGit χειρίζεται τη σύνταξη rev-parse (περισσότερες πληροφορίες στην ενότητα <a href="ch00/r_branch_references">Αναφορές κλάδων</a>)· μπορούμε να περάσουμε οποιονδήποτε προσδιοριστή αντικειμένου κατανοεί το Git και το JGit θα επιστρέψει είτε ένα έγκυρο ObjectId για αυτό το αντικείμενο είτε <code>null</code>.</p>
</div>
<div class="paragraph">
<p>Οι επόμενες δύο γραμμές δείχνουν τον τρόπο φόρτωσης των ανεπξέργαστων περιεχομένων ενός αντικειμένου.
Σε αυτό το παράδειγμα, καλούμε την <code>ObjectLoader.copyTo()</code> για να μεταφέρουμε τα περιεχόμενα του αντικειμένου απευθείας στην stdout, αλλά το η ObjectLoader έχει επίσης μεθόδους για να διαβάσει τον τύπο και το μέγεθος ενός αντικειμένου, καθώς και να το επιστρέψει σαν ένα byte array.
Για τα μεγάλα αντικείμενα (δηλαδή αυτά στα οποία η <code>.isLarge() επιστρέφει `true</code>), μπορούμε να καλέσουμε την <code>.openStream()</code> για να αποκτήσουμε ένα αντικείμενο τύπου InputStream που μπορεί να διαβάσει τα ανεπεξέργαστα δεδομένα του αντικειμένου χωρίς να το τραβήξει όλα στη μνήμη με τη μία.</p>
</div>
<div class="paragraph">
<p>Οι επόμενες γραμμές δείχνουν τι χρειάζεται για τη δημιουργία ενός νέου κλάδου.
Δημιουργούμε ένα στιγμιότυπο RefUpdate, διαμορφώνουμε κάποιες παραμέτρους και καλούμε <code>.update()</code> για να ενεργοποιήσουμε την αλλαγή.
Αμέσως μετά από αυτό είναι ο κώδικας για τη διαγραφή του ίδιου κλάδου.
Ας σημειωθεί ότι η <code>.setForceUpdate(true)</code> απαιτείται για να λειτουργήσει αυτό· διαφορετικά η κλήση <code>.delete()</code> θα επιστρέψει '<code>REJECTED</code> (ΑΠΟΡΡΙΠΤΕΤΑΙ`) και δεν θα συμβεί τίποτα.</p>
</div>
<div class="paragraph">
<p>Το τελευταίο παράδειγμα δείχνει τον τρόπο λήψης της τιμής <code>user.name</code> από τα αρχεία ρυθμίσεων του Git.
Αυτό το στιγμιότυπο Config χρησιμοποιεί το αποθετήριο που ανοίξαμε νωρίτερα για την τοπική διαμόρφωση, αλλά θα ανιχνεύσει αυτόματα τα καθολικά αρχεία διαμόρφωσης και αρχεία διαμόρφωσης του συστήματος και θα διαβάσει τιμές από αυτά.</p>
</div>
<div class="paragraph">
<p>Αυτό είναι μόνο ένα μικρό δείγμα πλήρους API διοχέτευσης· υπάρχουν πολλές άλλες διαθέσιμες μέθοδοι και τάξεις.
Επίσης, δεν εμφανίζεται εδώ ο τρόπος με τον οποίο η JGit χειρίζεται λάθη, που είναι με με τη χρήση εξαιρέσεων.
Τα API του JGit μερικές φορές πετούν τις συνήθεις εξαιρέσεις της Java (όπως την <code>IOException</code>), αλλά υπάρχουν και αρκετοί ειδικοί τύποι εξαιρέσεων JGit που παρέχονται επίσης (όπως <code>NoRemoteRepositoryException</code>, <code>CorruptObjectException</code> και <code>NoMergeBaseException</code>).</p>
</div>
</div>
<div class="sect3">
<h3 id="_πορσελάνες">Πορσελάνες</h3>
<div class="paragraph">
<p>Τα API διοχετεύσεων είναι μάλλον πλήρη, αλλά η σύζευξή τους για την επίτευξη κοινών στόχων, όπως η προσθήκη ενός αρχείου στο ευρετήριο ή η πραγματοποίηση μιας νέας υποβολής, μπορεί να είναι δυσχερής.
Το JGit παρέχει ένα σύνολο API υψηλότερου επιπέδου για να βοηθήσει με αυτό και το σημείο εισόδου σε αυτά τα API είναι η κλάση <code>Git</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Repository repo;
// construct repo...
Git git = new Git(repo);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Η κλάση Git έχει ένα ωραίο σύνολο μεθόδων υψηλού επιπέδου σε στυλ <em>builder</em>, που μπορούν να χρησιμοποιηθούν για την κατασκευή κάποιων πολύ περίπλοκων συμπεριφορών.
Ας ρίξουμε μια ματιά σε ένα παράδειγμα —κάνοντας κάτι σαν την <code>git ls-remote</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">CredentialsProvider cp = new UsernamePasswordCredentialsProvider("username", "p4ssw0rd");
Collection&lt;Ref&gt; remoteRefs = git.lsRemote()
    .setCredentialsProvider(cp)
    .setRemote("origin")
    .setTags(true)
    .setHeads(false)
    .call();
for (Ref ref : remoteRefs) {
    System.out.println(ref.getName() + " -&gt; " + ref.getObjectId().name());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Αυτό είναι ένα κοινό μοτίβο με την κλάση Git· οι μέθοδοι επιστρέφουν ένα αντικείμενο εντολής που μας επιτρέπει να κάνουμε αλυσιδωτές κλήσεις μεθόδων για να ορίσουμε παραμέτρους, οι οποίες εκτελούνται όταν καλούμε την <code>.call()</code>.
Σε αυτήν την περίπτωση, ζητάμε ετικέτες αλλά όχι αναφορές από τον <code>origin</code> του απομακρυσμένου αποθετηρίου.
Ας σημειωθεί επίσης η χρήση ενός αντικειμένου <code>CredentialsProvider</code> για την ταυτοποίηση.</p>
</div>
<div class="paragraph">
<p>Πολλές άλλες εντολές είναι διαθέσιμες μέσω της κλάσης Git, συμπεριλαμβανομένων, μεταξύ άλλων, των <code>add</code>,<code>blame</code>, <code>commit</code>, <code>clean</code>, <code>push</code>, <code>rebase</code>, <code>revert</code> και <code>reset</code>.</p>
</div>
</div>
<div class="sect3">
<h3 id="_περαιτέρω_ανάγνωση_2">Περαιτέρω ανάγνωση</h3>
<div class="paragraph">
<p>Αυτό είναι μόνο ένα μικρό δείγμα των πλήρων δυνατοτήτων του JGit.
Για όποιον ενδιαφέρεται και θέλιε να μάθει περισσότερα, θα βρούμε πληροφορίες και έμπνευση στα παρακάτω:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Η επίσημη τεκμηρίωση του API του JGit διατίθεται ηλεκτρονικά στην <a href="http://download.eclipse.org/jgit/docs/latest/apidocs" class="bare">http://download.eclipse.org/jgit/docs/latest/apidocs</a>.
  Αυτά είναι τα πρότυπα Javadoc, έτσι ώστε το αγαπημένο μας IDE JVM να μπορεί να τα εγκαταστήσει και σε τοπικό επίπεδο.</p>
</li>
<li>
<p>Το JGit Cookbook στην <a href="https://github.com/centic9/jgit-cookbook" class="bare">https://github.com/centic9/jgit-cookbook</a> έχει πολλά παραδείγματα για το πώς να κάνουμε συγκεκριμένες εργασίες με το JGit.</p>
</li>
<li>
<p>Υπάρχουν αρκετοί πόροι που έχουν επισημανθεί στην <a href="http://stackoverflow.com/questions/6861881" class="bare">http://stackoverflow.com/questions/6861881</a>.</p>
</li>
</ul>
</div>
</div>
<div id="nav"><a href="{{ page.book.section.previous | relative_url }}">prev</a> | <a href="{{ page.book.section.next | relative_url }}">next</a></div>