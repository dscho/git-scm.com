---
category: book
section: documentation
subsection: book
sidebar: book
book:
  language_code: gr
  chapter:
    title: Το Git στον διακομιστή
    number: 4
  section:
    title: Στήσιμο του διακομιστή
    number: 4
    cs_number: '4.4'
    previous: book/gr/v2/Το-Git-στον-διακομιστή-Δημιουργία-δημόσιου-κλειδιού-SSH
    next: book/gr/v2/Το-Git-στον-διακομιστή-Δαίμονες-του-Git
title: Git - Στήσιμο του διακομιστή

---
<h2 id="r_setting_up_server">Στήσιμο του διακομιστή</h2>
<div class="paragraph">
<p>Θα δούμε τώρα τη διαμόρφωση της πρόσβασης SSH από την πλευρά του διακομιστή.
Σε αυτό το παράδειγμα θα χρησιμοποιήσουμε τη μέθοδο <code>authorized_keys</code> για την ταυτοποίηση των χρηστών.
Υποθέτουμε επίσης ότι τρέχουμε μια τυπική διανομή Linux όπως το Ubuntu.
Καταρχήν, δημιουργούμε έναν χρήστη <code>git</code> και έναν κατάλογο <code>.ssh</code> για αυτόν τον χρήστη.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ sudo adduser git
$ su git
$ cd
$ mkdir .ssh &amp;&amp; chmod 700 .ssh
$ touch .ssh/authorized_keys &amp;&amp; chmod 600 .ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>Στη συνέχεια, πρέπει να προσθέσουμε δημόσια κλειδιά SSH για προγραμματιστές στο αρχείο <code>authorized_keys</code> του χρήστη <code>git</code>.
Ας υποθέσουμε ότι έχουμε ορισμένα αξιόπιστα δημόσια κλειδιά και τα έχουμε αποθηκεύσει σε προσωρινά αρχεία.
Υπενθυμίζουμε ότι τα δημόσια κλειδιά μοιάζουν με αυτό:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat /tmp/id_rsa.john.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCB007n/ww+ouN4gSLKssMxXnBOvf9LGt4L
ojG6rs6hPB09j9R/T17/x4lhJA0F3FR1rP6kYBRsWj2aThGw6HXLm9/5zytK6Ztg3RPKK+4k
Yjh6541NYsnEAZuXz0jTTyAUfrtU3Z5E003C4oxOj6H0rfIF1kKI9MAQLMdpGW1GYEIgS9Ez
Sdfd8AcCIicTDWbqLAcU4UpkaX8KyGlLwsNuuGztobF8m72ALC/nLF6JLtPofwFBlgc+myiv
O7TCUSBdLQlgMVOFq1I2uPWQOkOWQAHukEOmfjy2jctxSDBQ220ymjaNsHT4kgtZg2AYYgPq
dAv8JggJICUvax2T9va5 gsg-keypair</code></pre>
</div>
</div>
<div class="paragraph">
<p>Απλά τα συνάπτουμε στο τέλος του αρχείου <code>authorized_keys</code> του χρήστη <code>git</code> στον κατάλογο <code>.ssh</code> του χρήστη:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat /tmp/id_rsa.john.pub &gt;&gt; ~/.ssh/authorized_keys
$ cat /tmp/id_rsa.josie.pub &gt;&gt; ~/.ssh/authorized_keys
$ cat /tmp/id_rsa.jessica.pub &gt;&gt; ~/.ssh/authorized_keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>Τώρα, μπορούμε να δημιουργήσουμε ένα κενό αποθετήριο για αυτούς τους προγραμματιστές, τρέχοντας <code>git init</code> με την επιλογή <code>--bare</code>, η οποία αρχικοποιεί το αποθετήριο χωρίς κατάλογο εργασίας: </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /opt/git
$ mkdir project.git
$ cd project.git
$ git init --bare
Initialized empty Git repository in /opt/git/project.git/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Στη συνέχεια, ο John, ο Josie ή η Jessica μπορούν να ωθήσουν την πρώτη έκδοση του έργου τους σε αυτό το αποθετήριο, προσθέτοντάς το ως απομακρυσμένο και ωθώντας έναν κλάδο.
Να σημειωθεί ότι κάποιος πρέπει να μπαίνει στο κέλυφος στο συγκεκριμένο μηχάνημα και να δημιουργεί ένα γυμνό αποθετήριο κάθε φορά που θέλουμε να προσθέσουμε ένα έργο.
Ας χρησιμοποιήσουμε το <code>gitserver</code> ως το hostname του διακομιστή στον οποίο έχουμε δημιουργήσει τον χρήστη <code>git</code> και το αποθετήριο.
Αν το τρέξουμε εσωτερικά και έχουμε ρυθμίσει το DNS για το <code>gitserver</code> να δείχνει σε εκείνον τον διακομιστή, τότε μπορούμε να χρησιμοποιήσουμε τις εντολές σχεδόν όπως είναι (με την προϋπόθεση ότι το <code>myproject</code> είναι ένα υπάρχον έργο με αρχεία):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console"># on Johns computer
$ cd myproject
$ git init
$ git add .
$ git commit -m 'initial commit'
$ git remote add origin git@gitserver:/opt/git/project.git
$ git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Σε αυτό το σημείο, οι άλλοι μπορούν να κλωνοποιήσουν το αποθετήριο και και να ωθήσουν αλλαγές εξίσου εύκολα:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ git clone git@gitserver:/opt/git/project.git
$ cd project
$ vim README
$ git commit -am 'fix for the README file'
$ git push origin master</code></pre>
</div>
</div>
<div class="paragraph">
<p>Με αυτήν τη μέθοδο, μπορούμε να ξεκινήσουμε γρήγορα έναν διακομιστή Git ανάγνωσης/εγγραφής για μερικούς προγραμματιστές.</p>
</div>
<div class="paragraph">
<p>Θα πρέπει να σημειώσουμε ότι αυτήν τη στιγμή όλοι αυτοί οι χρήστες μπορούν επίσης να συνδεθούν στον διακομιστή και να ανοίξουν ένα κέλυφος ως χρήστης <code>git</code>.
Εάν θέλουμε να θέσουμε περιορισμό σε αυτό, θα πρέπει να αλλάξουμε το κέλυφος σε κάτι άλλο στο αρχείο <code>passwd</code>.</p>
</div>
<div class="paragraph">
<p>Μπορούμε εύκολα να περιορίσουμε τον χρήστη <code>git</code> να κάνει μόνο δραστηριότητες Git με ένα περιορισμένο εργαλείο κελύφους που ονομάζεται <code>git-shell</code> και διατίθεται στο Git.
Αν ορίσουμε αυτό ως το κέλυφος σύνδεσης του χρήστη <code>git</code>, τότε ο χρήστης <code>git</code> δεν μπορεί να έχει κανονική πρόσβαση μέσω του κελύφους στον διακομιστή μας.
Για να χρησιμοποιήσουμε το <code>git-shell</code> πρέπει να αντικαταστήσουμε το κέλυφος εισόδου του χρήστη από <code>bash</code> ή <code>csh</code> σε <code>git-shell</code>.
Για να το κάνουμε αυτό, πρέπει πρώτα να προσθέσουμε το <code>git-shell</code> στο <code>/etc/shells</code> αν δεν υπάρχει ήδη:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cat /etc/shells   # δες αν το `git-shell` βρίσκεται ήδη εκεί.  Αν όχι...
$ which git-shell   # επιβεβαίωσε ότι το git-shell είναι εγκατεστημένο στο σύστημα
$ sudo vim /etc/shells  # και πρόσθεσε τη διαδρομή για το git-shell από την προηγούμενη εντολή</code></pre>
</div>
</div>
<div class="paragraph">
<p>Τώρα μπορούμε να επεξεργαστούμε το κέλυφος για έναν χρήστη χρησιμοποιώντας <code>chsh &lt;όνομα_χρήστη&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ sudo chsh git  # και εισήγαγε τη διαδρομή για το git-shell, συνήθως: /usr/bin/git-shell</code></pre>
</div>
</div>
<div class="paragraph">
<p>Τώρα, ο χρήστης <code>git</code> μπορεί να χρησιμοποιήσει μόνο τη σύνδεση SSH για να ωθήσει και να έλξει αποθετήρια Git και δεν μπορεί να ανοίξει ένα κέλυφος στο μηχάνημα.
Αν προσπαθήσουμε, θα δούμε μια αποτυχία σύνδεσης όπως η παρακάτω:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ ssh git@gitserver
fatal: Interactive git shell is not enabled.
hint: ~/git-shell-commands should exist and have read and execute access.
Connection to gitserver closed.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Τώρα οι εντολές δικτύου του Git θα λειτουργούν ακόμα μια χαρά, αλλά οι χρήστες δεν θα μπορούν να ανοίξουν ένα κέλυφος.
Όπως αναφέρει και η έξοδος της εντολής, μπορούμε επίσης να ρυθμίσουμε έναν κατάλογο στον αρχικό κατάλογο του χρήστη <code>git</code> που προσαρμόζει ελαφρώς την εντολή <code>git-shell</code>.
Για παράδειγμα, μπορούμε να περιορίσουμε τις εντολές Git που δέχεται ο διακομιστής ή να προσαρμόσουμε το μήνυμα που βλέπουν οι χρήστες αν προσπαθούν να κάνουν SSH σε αυτό.
Τρέχουμε <code>git shell help</code> για περισσότερες πληροφορίες σχετικά με την προσαρμογή του κελύφους στις προτιμήσεις μας. </p>
</div>
<div id="nav"><a href="{{ page.book.section.previous | relative_url }}">prev</a> | <a href="{{ page.book.section.next | relative_url }}">next</a></div>